import { useState, useEffect } from 'react';

const c="USEPARAMS",w="popstate",k="?s",y="?n",h="?b",v="true";const pmask={str:k,num:y,bool:h};const U=()=>null,C=()=>typeof window<"u"?window.history:{},d=()=>new URLSearchParams(location.search),L=t=>Object.keys(t),S=()=>{const t=C().state;return t&&t[c]?t[c]:window[c]?window[c]:[...d()].reduce((e,[s,l])=>({...e,[s]:l}),{})},O=t=>new URL(`?${t.toString()}`,location).toString(),E=(t,e,s)=>{t&&(dispatchEvent(new CustomEvent(w,{detail:{param:t}})),window[c]=s,C().pushState({[c]:s},"",O(e)));};const removeParam=t=>{const e=S(),s=d();s.delete(t),delete e[t],E(t,s,e);},setParam=(t,e)=>{const s=d();s.set(t,e+""),E(t,s,{...S(),[t]:e});},useParams=t=>{const[e,s]=useState(0),[l,A]=useState({});return useEffect(()=>{const m=S(),i=d(),u={};let r="";const P=n=>{const o=t[n],p=m[n],f=i.get(n),V=n in t,T=p===void 0?o:p;if(f!=="undefined")return [k,y,h].includes(o)?(u[n]=p,o==y?f*1:o==h?f==v:f):(V&&f===null&&(r=v,i.set(n,T)),T)},a=[...L(m),...L(t)].reduce((n,o)=>({...n,[o]:P(o)}),{});A(a);const g={...a,...u};E(r,i,g);},[e]),useEffect(()=>{const m="next"in window&&window.next,i={events:{on:U,off:U}},u=m.router||i;function r({detail:P}){const a=P&&P.param;(!a||a in t||a===v)&&s(g=>g+1);}return addEventListener(w,r),u.events.on("routeChangeComplete",r),()=>{removeEventListener(w,r),u.events.off("routeChangeComplete",r);}},[]),l};

export { pmask, removeParam, setParam, useParams };
